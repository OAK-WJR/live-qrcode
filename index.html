<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>中国网络文化验证</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 700px;
      margin: auto;
      padding: 20px;
      background: #f9f9f9;
    }
    h2 {
      text-align: center;
    }
    .question {
      margin-bottom: 20px;
    }
    textarea {
      width: 100%;
      height: 60px;
      margin-top: 5px;
      font-size: 16px;
    }
    #qrcode {
      display: none;
      text-align: center;
      margin-top: 30px;
    }
    img {
      max-width: 90%;
      max-height: 300px;
    }
    button {
      display: block;
      margin: 20px auto;
      padding: 10px 20px;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <h2>中国网络文化验证</h2>

  <div class="question" id="mcQuestion"></div>
  <div class="question" id="open1"></div>
  <div class="question" id="open2"></div>

  <button onclick="checkAnswers()">提交答案</button>

  <div id="qrcode">
    <h3>你通过了测试！扫码加入微信群：</h3>
    <img src="qrcode.png" alt="二维码">
  </div>

  <script>
    const LOCK_TIME = 1000 * 60 * 10; // 10分钟

    const mcQuestion = {
      question: "以下哪一个人物和“真香定理”有关？",
      options: ["蔡徐坤", "王境泽", "孙笑川", "罗翔"],
      correct: 1 // "王境泽"
    };

    const openQuestions = [
      {
        prompt: "听到“打工是不可能打工的”，你会联想到什么？",
        keywords: ["嘴硬", "电瓶车", "这辈子都不可能", "监狱", "生活"]
      },
      {
        prompt: "听到“小黑子”，你会联想到什么？",
        keywords: ["篮球", "鸡", "坤", "孙笑川", "背带裤", "两年半", "带节奏"]
      }
    ];

    document.getElementById("mcQuestion").innerHTML = `
      <strong>选择题：</strong><br>${mcQuestion.question}<br>
      ${mcQuestion.options.map((opt, i) => `
        <label><input type="radio" name="mc" value="${i}"> ${opt}</label><br>
      `).join('')}
    `;

    openQuestions.forEach((q, i) => {
      document.getElementById(`open${i+1}`).innerHTML = `
        <strong>开放题 ${i+1}：</strong><br>${q.prompt}<br>
        <textarea id="openAns${i}"></textarea>
      `;
    });

    function checkAnswers() {
      const lastFail = localStorage.getItem("failTime");
      const now = Date.now();
      if (lastFail && now - lastFail < LOCK_TIME) {
        alert("你之前答错过，请10分钟后再试。");
        return;
      }

      let correct = 0;

      // 检查选择题
      const mcAns = document.querySelector("input[name='mc']:checked");
      if (mcAns && parseInt(mcAns.value) === mcQuestion.correct) correct++;

      // 检查开放题
      openQuestions.forEach((q, i) => {
        const ans = document.getElementById(`openAns${i}`).value;
        let match = 0;
        for (let k of q.keywords) {
          if (ans.includes(k)) match++;
        }
        if (match >= 2) correct++;
      });

      if (correct >= 2) {
        document.getElementById("qrcode").style.display = "block";
        alert("太懂了，欢迎进群！");
      } else {
        localStorage.setItem("failTime", Date.now());
        alert("不太像真懂的人，请10分钟后再试。");
      }
    }
  </script>
</body>
</html>
