<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>完成以下测试，验证为懂哥后显示入群二维码</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
      max-width: 700px;
      margin: 30px auto;
      padding: 25px;
      background: #f9f9f9;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      line-height: 1.6;
    }
    h2, h3 {
      text-align: center;
      color: #333;
    }
    p.intro {
        text-align: center;
        color: #555;
        font-size: 14px;
    }
    .question-section {
      margin-bottom: 25px;
      padding: 15px;
      background: #fff;
      border: 1px solid #eee;
      border-radius: 5px;
    }
    .question-item {
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px dashed #eee;
    }
    .question-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }
    .question-item strong {
        font-size: 18px;
        color: #0056b3;
    }
    .question-item p {
        margin: 5px 0 10px 0;
        font-size: 16px;
    }
    label {
        display: block;
        margin-bottom: 8px;
        cursor: pointer;
    }
    input[type="radio"] {
        margin-right: 8px;
    }
    textarea {
      width: calc(100% - 20px); /* Adjust width */
      height: 70px;
      margin-top: 5px;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
      resize: vertical;
    }
    button {
      display: block;
      margin: 30px auto 20px auto;
      padding: 12px 25px;
      font-size: 18px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
        background-color: #0056b3;
    }
    #result {
        text-align: center;
        margin-top: 20px;
        font-size: 18px;
    }
    #qrcode {
      display: none;
      text-align: center;
      margin-top: 20px;
    }
    #qrcode img {
      max-width: 90%;
      height: auto;
      max-height: 250px;
      border: 1px solid #ddd;
      padding: 5px;
      background: #fff;
    }
    footer {
        margin-top: 40px;
        text-align: center;
        font-size: 12px;
        color: #888;
    }
  </style>
</head>
<body>
  <h2>完成以下测试，验证为懂哥后显示入群二维码</h2>
  <p class="intro">答对两题即为通过</p>

  <div class="question-section" id="mcQuestions"></div>
  <div class="question-section" id="openQuestions"></div>

  <div id="result"></div>

  <button onclick="checkAnswers()">提交答案</button>

  <div id="qrcode">
    <img src="qrcode.png" alt="请在此处替换为你的二维码图片 (qrcode.png)">
  </div>

  <footer>
      <p><strong>注意：</strong> 此验证仅为趣味测试，基于前端技术实现，无法保证绝对安全。请勿将其用于严格的身份验证场景。请将 `qrcode.png` 替换为您自己的二维码图片。</p>
  </footer>

  <script>
    const LOCK_TIME = 1000 * 60 * 10; // 10分钟锁定时间
    const NUM_MC_QUESTIONS_TO_SHOW = 2; // **修改：显示 2 个选择题**
    const NUM_OPEN_QUESTIONS_TO_SHOW = 1; // **修改：显示 1 个简答题**
    const REQUIRED_SCORE = 2; // 通过测试所需的最少正确题数 (2/3)

    // **更新：问题库 - 选择题 (更大众化)**
    const mcQuestionsPool = [
        { q: "网络语“YYDS”通常用来表达什么？", o: ["有点意思", "永远单身", "永远的神", "要运动"], a: "永远的神" },
        { q: "“真香”定律通常和哪位人物关联最紧密？", o: ["奥利给大叔", "马保国", "王境泽", "药水哥"], a: "王境泽" },
        { q: "当网上有人说“666”时，他最可能想表达什么？", o: ["很无聊", "很厉害/赞", "再见", "骂人"], a: "很厉害/赞" },
        { q: "“干饭人”指的是什么样的人？", o: ["做饭很好吃的人", "特别爱吃饭的人", "减肥的人", "请客吃饭的人"], a: "特别爱吃饭的人" },
        { q: "“EMO了”最接近以下哪种情绪？", o: ["开心激动", "愤怒", "伤感/抑郁", "迷茫"], a: "伤感/抑郁" },
        { q: "“绝绝子”这个词通常用来表达什么？", o: ["非常糟糕", "表示拒绝", "非常棒/太绝了", "绝对没错"], a: "非常棒/太绝了"},
        { q: "“duck不必” 的意思是？", o: ["鸭子不用了", "大可不必", "快跑", "真是好鸭"], a: "大可不必"}
    ];

    // **更新：问题库 - 简答题 (更具代表性)**
    const openQuestionsPool = [
      { p: "听到“打工是不可能打工的”，你会联想到什么？（至少写两个相关点）", k: ["电瓶车", "这辈子", "监狱", "周某", "窃格瓦拉", "偷车", "老哥"] },
      { p: "请补全句子：“年轻人不讲____”，并说说你会联想到什么？（至少写两个相关点）", k: ["武德", "马保国", "耗子尾汁", "闪电", "五连鞭", "偷袭", "骗", "功夫"] },
      { p: "“秋天的第一杯奶茶”是什么意思？（至少写两个相关点）", k: ["秀恩爱", "红包", "关心", "季节", "奶茶", "流行", "52", "转账", "朋友圈"] },
      { p: "当你看到有人说 “退! 退! 退!” 时，通常是什么场景？（至少写两个相关点）", k: ["大妈", "吵架", "驱邪", "市场", "停车", "方言", "纠纷", "车位"] },
      { p: "“我只会心疼giegie” 这句话通常和谁有关，或者是什么梗？（至少写两个相关点）", k: ["绿茶", "哥哥", "心疼", "网红", "直播", "反讽", "土味"] }
    ];

    let selectedMcQuestions = [];
    let selectedOpenQuestions = [];

    // Fisher-Yates (aka Knuth) Shuffle 函数
    function shuffle(array) {
        let currentIndex = array.length, randomIndex;
        while (currentIndex !== 0) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;
            [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
        }
        return array;
    }

    // 设置问题的函数
    function setupQuestions() {
        // 随机打乱问题库
        shuffle(mcQuestionsPool);
        shuffle(openQuestionsPool);

        // 选取指定数量的问题
        selectedMcQuestions = mcQuestionsPool.slice(0, NUM_MC_QUESTIONS_TO_SHOW);
        selectedOpenQuestions = openQuestionsPool.slice(0, NUM_OPEN_QUESTIONS_TO_SHOW);

        // 渲染选择题
        const mcContainer = document.getElementById("mcQuestions");
        mcContainer.innerHTML = '<strong>选择题 (共 ' + NUM_MC_QUESTIONS_TO_SHOW + ' 题)：</strong><br>';
        selectedMcQuestions.forEach((qData, index) => {
            const shuffledOptions = shuffle([...qData.o]); // 复制并打乱选项
            qData.shuffledOptions = shuffledOptions;
            mcContainer.innerHTML += `
                <div class="question-item">
                    <p>${index + 1}. ${qData.q}</p>
                    ${shuffledOptions.map((opt) => `
                        <label><input type="radio" name="mc${index}" value="${opt}"> ${opt}</label>
                    `).join('')}
                </div>
            `;
        });

        // 渲染简答题
        const openContainer = document.getElementById("openQuestions");
        openContainer.innerHTML = '<strong>简答题 (共 ' + NUM_OPEN_QUESTIONS_TO_SHOW + ' 题)：</strong><br>';
        selectedOpenQuestions.forEach((qData, index) => {
            openContainer.innerHTML += `
                <div class="question-item">
                  <p>${index + 1}. ${qData.p}</p>
                  <textarea id="openAns${index}" placeholder="请在此输入你的联想..."></textarea>
                </div>
            `;
        });
        
        // 清除结果和隐藏二维码
        document.getElementById("result").innerHTML = '';
        document.getElementById("qrcode").style.display = "none";
        document.querySelector("button").style.display = "block";
        document.getElementById("mcQuestions").style.display = "block";
        document.getElementById("openQuestions").style.display = "block";
    }

    // 检查答案的函数
    function checkAnswers() {
        const lastFail = localStorage.getItem("failTime");
        const now = Date.now();
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = ''; // 清除上次的结果

        // 检查是否处于锁定状态
        if (lastFail && now - lastFail < LOCK_TIME) {
            const remaining = Math.ceil((LOCK_TIME - (now - lastFail)) / (1000 * 60));
            alert(`你之前答错过，请 ${remaining} 分钟后再试。`);
            return;
        }

        let correctCount = 0;
        const totalQuestions = NUM_MC_QUESTIONS_TO_SHOW + NUM_OPEN_QUESTIONS_TO_SHOW;

        // 检查选择题答案
        selectedMcQuestions.forEach((qData, index) => {
            const mcAns = document.querySelector(`input[name="mc${index}"]:checked`);
            if (mcAns && mcAns.value === qData.a) {
                correctCount++;
            }
        });

        // 检查简答题答案
        selectedOpenQuestions.forEach((qData, index) => {
            const ans = document.getElementById(`openAns${index}`).value.toLowerCase();
            let match = 0;
            for (let k of qData.k) {
                if (ans.includes(k.toLowerCase())) {
                    match++;
                }
            }
            // 至少需要匹配到2个关键词才算正确
            if (match >= 2) {
                correctCount++;
            }
        });

        // 判断结果
        if (correctCount >= REQUIRED_SCORE) {
            document.getElementById("qrcode").style.display = "block";
            document.querySelector("button").style.display = "none";
            document.getElementById("mcQuestions").style.display = "none";
            document.getElementById("openQuestions").style.display = "none";
            resultDiv.innerHTML = `<h3 style="color: green;">恭喜！你答对了 ${correctCount} / ${totalQuestions} 题，通过了测试！扫码加入微信群：</h3>`;
            localStorage.removeItem("failTime");
        } else {
            localStorage.setItem("failTime", Date.now());
            resultDiv.innerHTML = `<h3 style="color: red;">抱歉，你只答对了 ${correctCount} / ${totalQuestions} 题 (至少需要 ${REQUIRED_SCORE} 题)。不太像真懂的人，请10分钟后再试。</h3>`;
            document.getElementById("qrcode").style.display = "none";
            // 失败后1秒重新加载题目
            setTimeout(setupQuestions, 1000);
        }
    }

    // 页面加载时执行 setupQuestions 函数
    window.onload = setupQuestions;
  </script>
</body>
</html>