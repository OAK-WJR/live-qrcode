<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>【简洁版 V5】中国文化与网络知识验证</title>
  <style>
    /* 全局与字体设置 */
    body {
      font-family: "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
      background-color: #f8f9fa; /* 极浅灰底色 */
      color: #343a40; /* 主文字颜色 */
      line-height: 1.7;
      margin: 0;
      padding: 0;
    }

    /* 容器 */
    .container {
      max-width: 750px;
      margin: 50px auto;
      padding: 40px 60px; /* 增加内边距 */
      background-color: #ffffff; /* 白色背景 */
      border-radius: 12px; /* 更大的圆角 */
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08); /* 更柔和的阴影 */
      text-align: center; /* 内部元素默认居中 */
    }

    /* 标题与介绍 */
    h2 {
      font-size: 28px;
      font-weight: 600;
      color: #212529;
      margin-bottom: 15px;
    }
    p.intro {
      font-size: 15px;
      color: #6c757d; /* 灰色提示文字 */
      margin-bottom: 50px; /* 增加与问题的间距 */
    }

    /* 问题区域 */
    .question-section {
      margin-bottom: 40px;
      text-align: left; /* 问题区域左对齐 */
      border: none; /* 去除边框 */
      padding: 0;
    }
    .question-section strong {
        display: block;
        font-size: 18px;
        color: #495057;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #e9ecef;
    }

    .question-item {
      margin-bottom: 35px;
      padding-bottom: 35px;
      border-bottom: 1px solid #e9ecef;
    }
    .question-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .question-item p {
      font-size: 17px;
      font-weight: 500;
      margin-bottom: 20px;
    }

    /* 选项样式 */
    label {
      display: block;
      background-color: #fff;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 12px 20px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      display: flex;
      align-items: center;
    }
    label:hover {
      background-color: #f8f9fa;
      border-color: #adb5bd;
    }
    input[type="radio"] {
      appearance: none; /* 隐藏原生按钮 */
      width: 18px;
      height: 18px;
      border: 2px solid #adb5bd;
      border-radius: 50%;
      margin-right: 15px;
      outline: none;
      transition: all 0.2s ease-in-out;
      position: relative; /* 为伪元素定位 */
      flex-shrink: 0; /* 防止缩放 */
    }
    input[type="radio"]:checked {
        border-color: #007bff;
    }
    input[type="radio"]:checked::before { /* 创建选中标记 */
        content: '';
        display: block;
        width: 10px;
        height: 10px;
        background-color: #007bff;
        border-radius: 50%;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }
    label:has(input[type="radio"]:checked) { /* 选中标签样式 */
        border-color: #007bff;
        background-color: #e7f3ff;
        color: #0056b3;
    }


    /* 输入框 */
    textarea {
      width: calc(100% - 24px);
      height: 90px;
      margin-top: 5px;
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ced4da;
      border-radius: 8px;
      resize: vertical;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    textarea:focus {
        border-color: #80bdff;
        outline: 0;
        box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
    }

    /* 按钮 */
    button {
      display: inline-block; /* 允许居中 */
      margin: 40px auto 20px auto;
      padding: 15px 45px; /* 更大的内边距 */
      font-size: 18px;
      font-weight: 500;
      background-color: #343a40; /* 深灰色按钮 */
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
      box-shadow: 0 4px 10px rgba(52, 58, 64, 0.2);
    }
    button:hover {
        background-color: #212529; /* 悬停时更深 */
        transform: translateY(-2px); /* 轻微上浮 */
    }
     button:disabled {
        background-color: #adb5bd;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }


    /* 结果与二维码 */
    #result h3 {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 30px;
    }
    #qrcode {
      display: none;
      text-align: center;
      margin-top: 30px;
      padding: 30px;
      background-color: #fff;
      border-radius: 12px;
      /* box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08); */
    }
    #qrcode h3 {
        font-size: 18px;
        color: #495057;
        margin-bottom: 25px;
    }
    #qrcode img {
      max-width: 80%; /* 相对容器宽度 */
      height: auto;
      max-height: 350px; /* **显著增大二维码最大高度** */
      border: 1px solid #e9ecef;
      padding: 15px; /* 增加内边距 */
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1); /* 添加阴影 */
    }

    /* 页脚 */
    footer {
        margin-top: 60px;
        text-align: center;
        font-size: 12px;
        color: #adb5bd; /* 更浅的页脚颜色 */
    }

  </style>
</head>
<body>

  <div class="container"> <h2>【简洁版 V5】中国文化与网络知识验证</h2>
    <p class="intro">请完成以下测试，展现你对中国文化的了解程度。<br>共 4 题，答对 3 题及以上即可通过！</p>

    <div class="question-section" id="mcQuestions"></div>
    <div class="question-section" id="openQuestions"></div>

    <div id="result"></div>

    <button id="submitBtn" onclick="checkAnswers()">提交答案</button>

    <div id="qrcode">
        <h3>恭喜！通过验证，欢迎扫码加入：</h3>
        <img src="qrcode.png" alt="请在此处替换为你的二维码图片 (qrcode.png)">
    </div>

    <footer>
        <p><strong>注意：</strong> 此验证仅为趣味测试，简答题通过关键词进行初步判断，无法做到完全智能。请将 `qrcode.png` 替换为您自己的二维码图片。</p>
    </footer>
  </div> <script>
    const LOCK_TIME_SHORT = 1000 * 20;
    const LOCK_TIME_LONG = 1000 * 60 * 10;
    const NUM_MC_QUESTIONS_TO_SHOW = 2;
    const NUM_OPEN_QUESTIONS_TO_SHOW = 2;
    const REQUIRED_SCORE = 3;
    const OPEN_Q_KEYWORD_THRESHOLD = 1;

    const mcQuestionsPool = [
        { q: "在中国大陆，哪个APP以‘砍一刀’和社交裂变购物模式著称？", o: ["淘宝", "京东", "微信", "拼多多"], a: "拼多多" },
        { q: "经典电视剧《西游记》中，孙悟空被如来佛祖压在哪座山下五百年？", o: ["花果山", "火焰山", "五行山", "昆仑山"], a: "五行山" },
        { q: "提到春晚小品，很多人会首先想到哪位被称为‘小品王’的演员？", o: ["陈佩斯", "郭德纲", "赵本山", "沈腾"], a: "赵本山" },
        { q: "在中国大陆，学生们面临的最重要的一次升学考试通常是？", o: ["中考", "高考", "考研", "公务员考试"], a: "高考" },
        { q: "网络语“YYDS”通常用来表达什么意思？", o: ["有点意思", "永远单身", "永远的神", "要运动"], a: "永远的神" },
        { q: "“干饭人”这个词通常指的是什么样的人？", o: ["做饭很好吃的人", "特别爱吃饭的人", "减肥的人", "请客吃饭的人"], a: "特别爱吃饭的人" }
    ];

    const openQuestionsPool = [
      { p: "“鸡汤来了”这个梗出自哪部谍战剧？你会联想到哪些名场面或台词？", k: ["潜伏", "孙红雷", "穿山甲", "郝队长", "咸", "饭馆", "军统", "补", "这鸡", "味道", "保密局"] },
      { p: "“元芳，此事你怎么看？”这句话出自哪部电视剧？常用来表达什么？", k: ["狄仁杰", "张子健", "梁冠华", "询问", "意见", "吐槽", "梗", "神探", "你怎么看"] },
      { p: "提到‘螺蛳粉’，你会想到它的什么特点和哪个城市？", k: ["臭", "闻", "香", "辣", "广西", "柳州", "酸笋", "米粉", "上头", "嗦粉", "味道大"] },
      { p: "“年轻人不讲____”，请补全句子并说说你会联想到什么？", k: ["武德", "马保国", "耗子尾汁", "闪电", "五连鞭", "偷袭", "骗", "功夫", "传统", "69岁"] },
      { p: "在中国，提到“广场舞”，你通常会联想到什么样的场景和人群？", k: ["大妈", "晚上", "公园", "广场", "音乐", "凤凰传奇", "扰民", "健身", "集体", "音响"] }
    ];

    let selectedMcQuestions = [];
    let selectedOpenQuestions = [];

    function shuffle(array) {
        let currentIndex = array.length, randomIndex;
        while (currentIndex !== 0) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;
            [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
        }
        return array;
    }

    function setupQuestions() {
        shuffle(mcQuestionsPool);
        shuffle(openQuestionsPool);
        selectedMcQuestions = mcQuestionsPool.slice(0, NUM_MC_QUESTIONS_TO_SHOW);
        selectedOpenQuestions = openQuestionsPool.slice(0, NUM_OPEN_QUESTIONS_TO_SHOW);

        const mcContainer = document.getElementById("mcQuestions");
        mcContainer.innerHTML = '<strong>选择题：</strong>'; // 简化标题
        selectedMcQuestions.forEach((qData, index) => {
            const shuffledOptions = shuffle([...qData.o]);
            qData.shuffledOptions = shuffledOptions;
            mcContainer.innerHTML += `
                <div class="question-item">
                    <p>${index + 1}. ${qData.q}</p>
                    ${shuffledOptions.map((opt) => `
                        <label>
                            <input type="radio" name="mc${index}" value="${opt}">
                            <span>${opt}</span> 
                        </label>
                    `).join('')}
                </div>
            `;
        });

        const openContainer = document.getElementById("openQuestions");
        openContainer.innerHTML = '<strong>简答题：</strong>'; // 简化标题
        selectedOpenQuestions.forEach((qData, index) => {
            const qNum = NUM_MC_QUESTIONS_TO_SHOW + index + 1;
            openContainer.innerHTML += `
                <div class="question-item">
                  <p>${qNum}. ${qData.p}</p>
                  <textarea id="openAns${index}" placeholder="聊聊你的看法..."></textarea>
                </div>
            `;
        });

        document.getElementById("result").innerHTML = '';
        document.getElementById("qrcode").style.display = "none";
        document.getElementById("submitBtn").style.display = "inline-block"; // 改为 inline-block 以便居中
        document.getElementById("submitBtn").disabled = false;
        document.getElementById("mcQuestions").style.display = "block";
        document.getElementById("openQuestions").style.display = "block";
    }

    function checkAnswers() {
        const resultDiv = document.getElementById("result");
        const submitBtn = document.getElementById("submitBtn");
        const qrcodeDiv = document.getElementById("qrcode");
        resultDiv.innerHTML = '';
        const now = Date.now();

        const failTime = parseInt(localStorage.getItem("failTime") || 0);
        const failCount = parseInt(localStorage.getItem("failCount") || 0);

        if (failTime > 0) {
            const elapsed = now - failTime;
            if (failCount >= 2 && elapsed < LOCK_TIME_LONG) {
                const remaining = Math.ceil((LOCK_TIME_LONG - elapsed) / (1000 * 60));
                alert(`失败次数过多，请 ${remaining} 分钟后再试。`);
                return;
            }
            if (failCount === 1 && elapsed < LOCK_TIME_SHORT) {
                const remaining = Math.ceil((LOCK_TIME_SHORT - elapsed) / 1000);
                alert(`操作过快，请 ${remaining} 秒后再试。`);
                return;
            }
        }

        let correctCount = 0;
        const totalQuestions = NUM_MC_QUESTIONS_TO_SHOW + NUM_OPEN_QUESTIONS_TO_SHOW;

        selectedMcQuestions.forEach((qData, index) => {
            const mcAns = document.querySelector(`input[name="mc${index}"]:checked`);
            if (mcAns && mcAns.value === qData.a) {
                correctCount++;
            }
        });

        selectedOpenQuestions.forEach((qData, index) => {
            const ans = document.getElementById(`openAns${index}`).value.toLowerCase();
            let match = 0;
            const threshold = qData.t || OPEN_Q_KEYWORD_THRESHOLD;
            for (let k of qData.k) {
                if (ans.includes(k.toLowerCase())) {
                    match++;
                }
            }
            if (match >= threshold) {
                correctCount++;
            }
        });

        if (correctCount >= REQUIRED_SCORE) {
            qrcodeDiv.style.display = "block"; // 显示二维码区域
            qrcodeDiv.querySelector('h3').innerHTML = `<span style="color: #28a745;">恭喜！你答对了 ${correctCount} / ${totalQuestions} 题，通过验证！</span><br>欢迎扫码加入：`;
            submitBtn.style.display = "none";
            document.getElementById("mcQuestions").style.display = "none";
            document.getElementById("openQuestions").style.display = "none";
            resultDiv.style.display = "none"; // 隐藏旧的结果区
            localStorage.removeItem("failCount");
            localStorage.removeItem("failTime");
        } else {
            let currentFailCount = failCount;
            if (failTime > 0 && now - failTime >= LOCK_TIME_LONG) {
                currentFailCount = 0;
            }

            const newFailCount = currentFailCount + 1;
            localStorage.setItem("failCount", newFailCount);
            localStorage.setItem("failTime", now);
            
            resultDiv.style.display = "block"; // 确保结果区可见

            if (newFailCount >= 2) {
                resultDiv.innerHTML = `<h3 style="color: #dc3545;">抱歉，答对 ${correctCount} / ${totalQuestions} 题。第 2 次失败，请 10 分钟后再试！</h3>`;
                submitBtn.disabled = true;
            } else {
                resultDiv.innerHTML = `<h3 style="color: #ffc107;">抱歉，答对 ${correctCount} / ${totalQuestions} 题。第 1 次失败，请 20 秒后再试！</h3>`;
                 submitBtn.disabled = true;
                 setTimeout(() => { submitBtn.disabled = false; }, LOCK_TIME_SHORT);
            }
            qrcodeDiv.style.display = "none";
        }
    }

    window.onload = setupQuestions;
  </script>

</body>
</html>